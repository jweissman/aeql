(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{125:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(40),u=n.n(i),l=(n(49),n(50),n(8)),o=n(4),s=n.n(o),m=n(7),d=n(5),f=n(3),h=n(16),p=n(15),b=n(17),v=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},E=function(e){return e.toLowerCase()},y=(n(52),function(e){var t=e.models;return t.length?c.a.createElement("section",{className:"EntityTable"},c.a.createElement("h3",null,e.collectionName),c.a.createElement("table",null,c.a.createElement("thead",null,c.a.createElement("tr",null,Object.entries(t[0]).map(function(e){var t=Object(l.a)(e,2),n=t[0];t[1];return c.a.createElement("th",{key:n},v(n))}))),c.a.createElement("tbody",null,t.map(function(e){return c.a.createElement("tr",{key:e.id},c.a.createElement(c.a.Fragment,null,Object.entries(e).map(function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return c.a.createElement("td",{key:n},a instanceof Object?"[object]":a)})))})))):c.a.createElement("p",null,"Nothing.")}),g=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(p.a)(t).call(this,e))).textarea=void 0,n.intervalID=0,n.lastValue="nothing",n.polling=!1,n.textarea=c.a.createRef(),n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.intervalID=window.setInterval(function(){if(e.lastValue&&e.lastValue!=e.textarea.current.value&&!e.polling){var t=e.textarea.current.value;e.props.parseAeql(t),e.lastValue=t}},150)}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalID)}},{key:"render",value:function(){var e=this.props.resultData;return c.a.createElement("div",{className:"AeqlQuery"},c.a.createElement("label",null,c.a.createElement("textarea",{id:"query",ref:this.textarea,defaultValue:this.props.initialQuery||"find humans"})),c.a.createElement("section",{className:"Result"},c.a.createElement("h3",null,this.props.result),this.props.errors&&c.a.createElement("div",{style:{textAlign:"justify",whiteSpace:"pre-wrap"}},this.props.errors.split("\n").map(function(e){return c.a.createElement("p",{key:e},c.a.createElement("code",null,e))}))||e instanceof Object&&c.a.createElement(y,{models:e})))}}]),t}(c.a.Component),j=n(10),w=n.n(j),O=n(41);if(n.n(O).a){var k=n(107).readFileSync("./src/Aeql/Aeql.ohm");a=w.a.grammar(k)}else a=w.a.grammarFromScriptElement();var N=a,x=n(25),A=function(){function e(t){Object(d.a)(this,e),this.value=t}return Object(f.a)(e,[{key:"describe",value:function(){return this.value}},{key:"getValue",value:function(){return this.value}}]),e}(),S=function(){function e(t){Object(d.a)(this,e),this.value=t}return Object(f.a)(e,[{key:"describe",value:function(){return this.value.toString()}},{key:"getValue",value:function(){return this.value}}]),e}(),R=function(){function e(t){Object(d.a)(this,e),this.url=t}return Object(f.a)(e,[{key:"getUrl",value:function(){return this.url}},{key:"describe",value:function(){return this.url}}]),e}(),C=function(){function e(t,n){Object(d.a)(this,e),this.identifier=t,this.via=n}return Object(f.a)(e,null,[{key:"of",value:function(t){return new e(new A(t))}}]),Object(f.a)(e,[{key:"describe",value:function(){return this.via?"".concat(this.identifier.describe()," via ").concat(this.via.describe()):this.identifier.describe()}},{key:"getName",value:function(){return this.identifier.getValue()}},{key:"hasVehicle",value:function(){return!!this.via}},{key:"getVehicle",value:function(){return this.via}}]),e}(),I=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(d.a)(this,e),this.resources=t,this.projections=n}return Object(f.a)(e,null,[{key:"of",value:function(t){return new e([C.of(t)])}},{key:"project",value:function(t,n){return new e([C.of(t)],n.map(function(e){return new A(e)}))}},{key:"join",value:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return new e(n.map(function(e){return C.of(e)}))}}]),Object(f.a)(e,[{key:"isProjected",value:function(){return!!this.projections.length}},{key:"describe",value:function(){var e=this.resources.map(function(e){return e.getName()}).join(" and ");return this.projections.length?this.projections.map(function(e){return e.describe()}).join(", ")+" of ".concat(e):e}},{key:"getResources",value:function(){return this.resources}},{key:"getProjects",value:function(){return this.projections}}]),e}(),q=function(){function e(t,n){Object(d.a)(this,e),this.attributeName=t,this.attributeExpr=n}return Object(f.a)(e,[{key:"getAttributeName",value:function(){return this.attributeName.getValue()}},{key:"getValue",value:function(){return this.attributeExpr.getValue()}}]),Object(f.a)(e,[{key:"describe",value:function(){return"".concat(this.attributeName.describe()," is ").concat(this.attributeExpr.describe())}}]),e}(),_=function(){function e(t){Object(d.a)(this,e),this.name=t}return Object(f.a)(e,[{key:"describe",value:function(){return"".concat(this.name.describe())}},{key:"getName",value:function(){return this.name.getValue()}}]),e}(),D=function(){function e(t,n,a){Object(d.a)(this,e),this.subject=t,this.order=n,this.conditions=a}return Object(f.a)(e,[{key:"describe",value:function(){console.log("conditions",this.conditions);var e="";this.conditions&&this.conditions.length&&(e="where ".concat(this.conditions.map(function(e){return e.describe()})));var t="";this.order&&(t="by ".concat(this.order.describe()));return"Find ".concat(this.subject.describe()," ").concat(t," ").concat(e," ").concat("")}}]),e}(),V={Query:function(e,t,n){var a=t.tree(),r=n.tree(),c=void 0,i=[];return r instanceof Array&&r.forEach(function(e){if(e instanceof _){if(c)throw new Error("Can't have multiple orderings");c=e}else if(e instanceof Array&&e.length&&e[0]instanceof q){if(i.length)throw new Error("Can't have multiple conditions");i=e}}),new D(a,c,i)},Entity_simple:function(e){return new I(e.tree())},Entity_projection:function(e,t,n){var a=new I(n.tree(),e.tree());return console.log("PROJ",a),a},Resource_vehicle:function(e,t,n){return new C(e.tree(),n.tree())},Resource_basic:function(e){return new C(e.tree())},Criteria:function(e,t){return t.tree()},Conditions:function(e){return e.tree()},Condition:function(e,t,n){return new q(e.tree(),n.tree())},Order:function(e,t){var n=t.tree();return new _(n)},Vehicle:function(e,t){return new R("/"+t.tree())},URL:function(e){return e.sourceString},EmptyListOf:function(){return[]},emptyListOf:function(){return[]},NonemptyListOf:function(e,t,n){return[e.tree()].concat(Object(x.a)(n.tree()))},nonemptyListOf:function(e,t,n){return[e.tree()].concat(Object(x.a)(n.tree()))},number_whole:function(e){return new S(Number(e.sourceString))},ident:function(e,t){return new A(e.sourceString+t.sourceString)}},P=N.createSemantics();P.addOperation("tree",V);var L=P,M=n(12),T=n(42),Q=n.n(T),U=n(24),F=n.n(U),J=function(){function e(t){Object(d.a)(this,e),this.data=void 0,this.data=Object(M.a)({},t)}return Object(f.a)(e,[{key:"gatherResource",value:function(){var e=Object(m.a)(s.a.mark(function e(t){var n,a,r,c,i,u,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.data,a=[],r=t.getName(),c=v(r),!(i=t.getVehicle())){e.next=13;break}return u=i,e.next=9,Q.a.get(u.getUrl(),{baseURL:"https://jsonplaceholder.typicode.com"});case 9:l=e.sent,a=l.data,e.next=18;break;case 13:if(!n[c]||!n[c].length){e.next=17;break}n[c].forEach(function(e){return a.push(Object(M.a)({},e))}),e.next=18;break;case 17:throw new Error("Could not gather data for resource ".concat(t.describe()));case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"gatherResources",value:function(){var t=Object(m.a)(s.a.mark(function t(n){var a,r,c,i=this;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.map(function(){var e=Object(m.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,i.gatherResource(t);case 3:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,collection:e.t1});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),t.next=3,Promise.all(a);case 3:return r=t.sent,c=r.reduce(function(t,n){return e.join(t,n)}),t.abrupt("return",c.collection);case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},{key:"inquire",value:function(){var e=Object(m.a)(s.a.mark(function e(t){var n,a,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("PROCESS SIMPLE QUERY MANUALLY",{q:t}),e.next=3,this.gatherResources(t.subject.getResources());case 3:return n=e.sent,t.order&&(a=t.order,r=a.getName(),n=n.sort(function(e,t){return e[r]>t[r]?1:-1})),t.conditions&&t.conditions.forEach(function(e){var t=e.getAttributeName(),a=e.getValue();n=n.filter(function(e){var n=e[t]==a;return console.log({it:e,matches:n}),!!n}),console.log("APPLY CONDITION",{condition:e,collection:n})}),t.subject.isProjected()&&(n=n.map(function(e){var n={id:e.id};return t.subject.getProjects().forEach(function(t){var a=t.getValue();n[a]=e[a]}),console.log("PROJECTED",{it:e,projection:n}),n})),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}],[{key:"join",value:function(e,t){var n=e.resource,a=e.collection,r=t.resource,c=t.collection,i=n.getName(),u=r.getName(),l=[];if(u!==i&&c&&c.length){var o=c.slice().map(function(e){return Object(M.a)({},e)});if(o.length){var s=Object.keys(o[0]),m=Object.keys(a[0]),d=F.a.singular(E(i)),f=F.a.singular(E(u)),h=new RegExp(d+"?.id","i"),p=new RegExp(f+"?.id","i"),b=s.find(function(e){return e.match(h)})||"",v=m.find(function(e){return e.match(p)})||"";(b||v)&&(l=a.flatMap(function(e){if(e.id){var t=o.find(function(t){return b&&t[b]===e.id||v&&e[v]==t.id});if(t)return Object(M.a)({},e,t)}}).flat().filter(function(e){return void 0!==e}).map(function(e,t){return e.id=t+1,e}))}}return{resource:n,collection:l}}}]),e}(),B=new(function(){function e(t){Object(d.a)(this,e),this.config=t,this.personae=void 0,this.models=void 0,this.data=void 0,t.personae&&(this.personae=t.personae),t.data&&(this.data=t.data),t.models&&(this.models=t.models)}return Object(f.a)(e,[{key:"interpret",value:function(e){var t=N.match(e);if(t.succeeded())return L(t).tree();throw new Error("Could not parse input string: "+t.message)}},{key:"evaluate",value:function(){var t=Object(m.a)(s.a.mark(function t(n){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.data){t.next=7;break}return t.next=3,e.processSimpleQueryManually(n,this.data||{});case 3:return a=t.sent,t.abrupt("return",a);case 7:throw new Error("No data provided!");case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"resolve",value:function(){var e=Object(m.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.evaluate(this.interpret(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}],[{key:"processSimpleQueryManually",value:function(){var e=Object(m.a)(s.a.mark(function e(t,n){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new J(n),e.abrupt("return",a.inquire(t));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}())({personae:{Human:{name:"Text",age:"Int"},Employee:{name:"Text",employee_number:"Int",age:"Int",salary:"Int",department_id:"Id"}},models:{Department:{area:"Text"}},data:{Humans:[{id:1,name:"Zeta",age:59},{id:2,name:"Bob",age:23},{id:3,name:"Jim",age:19},{id:4,name:"Abel",age:24},{id:5,name:"Sawyer",age:34}],Employees:[{id:1,name:"Rhonda",department_id:1,employee_number:1002,age:47,salary:14e3},{id:2,name:"Barbara-Anniston",department_id:1,employee_number:1034,age:23,salary:18e3},{id:3,name:"Carol Andrews",department_id:2,employee_number:1045,age:35,salary:1e4},{id:4,name:"Sandra Amberg",department_id:3,employee_number:5044,age:42,salary:18500},{id:5,name:"Andra Saunders",department_id:3,employee_number:231,age:23,salary:8e3},{id:6,name:"Exandra Calabanza",department_id:3,employee_number:1,age:68,salary:12e3}],Departments:[{id:1,area:"Finance"},{id:2,area:"Human Resources"},{id:3,area:"Logistics"}]}}),H=function(){return c.a.createElement("section",{className:"Tips",style:{backgroundColor:"#e4eae9"}},c.a.createElement("h3",null,"how-to"),c.a.createElement("dl",null,c.a.createElement("dt",null,"QUERY FORM"),c.a.createElement("dd",null,"the most basic form of a query begins with ",c.a.createElement("code",null,"find")," or ",c.a.createElement("code",null,"get"),"\xa0 followed by a model name"),c.a.createElement("code",null,"find humans"),c.a.createElement("hr",null),c.a.createElement("dt",null,"ORDERING"),c.a.createElement("dd",null,"you can order by attributes with ",c.a.createElement("code",null,"by"),"\xa0 followed by the attribute name"),c.a.createElement("code",null,"find employees by salary"),c.a.createElement("hr",null),c.a.createElement("dt",null,"SELECTION"),c.a.createElement("dd",null,"pick rows using ",c.a.createElement("code",null,"with"),", ",c.a.createElement("code",null,"where")," or ",c.a.createElement("code",null,"whose")," "),c.a.createElement("code",null,"find humans whose age is 34"),c.a.createElement("hr",null),c.a.createElement("dt",null,"PROJECTION"),c.a.createElement("dd",null,"pick columns using ",c.a.createElement("code",null,"find ... of")),c.a.createElement("code",null,"find name, salary of employees where age is 47"),c.a.createElement("hr",null),c.a.createElement("dt",null,"FETCHING"),c.a.createElement("dd",null,"load data with ",c.a.createElement("code",null,"via")," followed by the path"),c.a.createElement("code",null,"find users via /users whose name is Bret"),c.a.createElement("hr",null),c.a.createElement("dt",null,"JOINING"),c.a.createElement("dd",null,"meld table data together with ",c.a.createElement("code",null,"find ... and ...`")),c.a.createElement("code",null,"find employees and departments")))},W=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(h.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={query:"",errors:"",result:"",resultData:[]},n.parseAeql=function(){var e=Object(m.a)(s.a.mark(function e(t){var a,r,c,i,u;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(a=t)){e.next=5;break}n.setState({query:"",result:""}),e.next=20;break;case 5:return r="",c=void 0,i=[],e.prev=8,u=B.interpret(a),r=u.describe(),e.next=13,B.evaluate(u);case 13:i=e.sent,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),c=e.t0.message;case 19:n.setState({query:a,result:r,errors:c,resultData:i});case 20:case"end":return e.stop()}},e,null,[[8,16]])}));return function(t){return e.apply(this,arguments)}}(),n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return c.a.createElement("div",null,c.a.createElement("h3",null,"query playground"),c.a.createElement("section",{className:"TipsAndQuery"},c.a.createElement(H,null),c.a.createElement(g,{initialQuery:"find humans by name",errors:this.state.errors,parseAeql:this.parseAeql,result:this.state.result,resultData:this.state.resultData})),c.a.createElement("hr",null),c.a.createElement("h4",null,"Playground Data"),c.a.createElement("section",{className:"SchemaAndData"},c.a.createElement("section",{className:"Data"},B.data&&Object.entries(B.data).map(function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return c.a.createElement(y,{key:n,collectionName:n,models:a})})),c.a.createElement("section",{className:"Schema"},c.a.createElement("i",null,"SCHEMA"),c.a.createElement("h3",null,"PERSONAE"),B.personae&&Object.entries(B.personae).map(function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return c.a.createElement("section",{className:"persona",key:n},c.a.createElement("h5",null,"Persona ",n),c.a.createElement("div",null,Object.entries(a).map(function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return c.a.createElement("div",{key:n},n," (",a,")")})))}),c.a.createElement("h3",null,"MODELS"),B.models&&Object.entries(B.models).map(function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return c.a.createElement("section",{className:"models",key:n},c.a.createElement("h5",null,"Model ",n),c.a.createElement("div",null,Object.entries(a).map(function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return c.a.createElement("div",{key:n},n," (",a,")")})))}))))}}]),t}(r.Component),Y=function(){return c.a.createElement("span",{className:"Aeql-name",style:{color:"#aeeaea",textShadow:"1.2px 1.2px #aeaeae",fontSize:"135%",fontWeight:"bolder"}},"aeql")},G=function(){return c.a.createElement("div",{className:"App"},c.a.createElement("header",{className:"App-header"},c.a.createElement("h1",null,"aeql-lang")),c.a.createElement("div",{className:"App-wrapper"},c.a.createElement("main",{className:"App-main"},c.a.createElement("section",{className:"Welcome Card",style:{backgroundColor:"#fafaf3"}},c.a.createElement("h4",null,"let's learn all about ",c.a.createElement(Y,null),"!"),c.a.createElement("ul",null,c.a.createElement("li",null,"naturalism"),c.a.createElement("li",null,"human values"),c.a.createElement("li",null,"categoreal design")),c.a.createElement("code",null,"find humans who are awesome")),c.a.createElement("section",{className:"QueryManager Card"},c.a.createElement(W,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(c.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},43:function(e,t,n){e.exports=n(125)},49:function(e,t,n){},50:function(e,t,n){},52:function(e,t,n){}},[[43,1,2]]]);
//# sourceMappingURL=main.0f564304.chunk.js.map